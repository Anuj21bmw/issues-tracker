
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; background: #f5f5f5; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .demo-btn { background: #6c757d; margin: 5px 0; padding: 8px; }
        .status { text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Issues Tracker</h1>
        <div class="status" id="status">Backend Status: <span id="statusText">Checking...</span></div>
        
        <form id="loginForm">
            <input type="email" id="email" placeholder="Email" value="admin@example.com" required>
            <input type="password" id="password" placeholder="Password" value="admin123" required>
            <button type="submit">Sign In</button>
        </form>
        
        <div style="margin-top: 20px;">
            <h3>Demo Accounts:</h3>
            <button class="demo-btn" onclick="setDemo('admin@example.com', 'admin123')">üëë Admin</button>
            <button class="demo-btn" onclick="setDemo('maintainer@example.com', 'maintainer123')">üîß Maintainer</button>
            <button class="demo-btn" onclick="setDemo('reporter@example.com', 'reporter123')">üìù Reporter</button>
        </div>
    </div>

    <script>
        // Test backend connection
        async function testBackend() {
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    document.getElementById('statusText').innerHTML = '‚úÖ Connected';
                    document.getElementById('statusText').style.color = 'green';
                } else {
                    document.getElementById('statusText').innerHTML = '‚ùå Failed';
                    document.getElementById('statusText').style.color = 'red';
                }
            } catch (error) {
                document.getElementById('statusText').innerHTML = '‚ùå Error';
                document.getElementById('statusText').style.color = 'red';
            }
        }

        // Set demo credentials
        function setDemo(email, password) {
            document.getElementById('email').value = email;
            document.getElementById('password').value = password;
        }

        // Handle login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const formData = new FormData();
                formData.append('username', email);
                formData.append('password', password);

                const response = await fetch('http://localhost:8000/api/auth/login', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    alert('Login failed: ' + (error.detail || 'Unknown error'));
                    return;
                }

                const data = await response.json();
                
                // Get user info
                const userResponse = await fetch('http://localhost:8000/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${data.access_token}` }
                });

                if (userResponse.ok) {
                    const user = await userResponse.json();
                    localStorage.setItem('auth_token', data.access_token);
                    localStorage.setItem('auth_user', JSON.stringify(user));
                    alert('Login successful! User: ' + user.full_name + ' (' + user.role + ')');
                    // You can redirect here once other pages are working
                } else {
                    alert('Failed to get user info');
                }
            } catch (error) {
                alert('Login error: ' + error.message);
            }
        });

        // Test backend on load
        testBackend();
    </script>
</body>
</html>
